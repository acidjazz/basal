machine:
  timezone:
    America/Los_Angeles
  php:
    version: 7.0.4
  environment:
    ENVIRONMENT: testing
    APP_ENV: testing
    APP_DEBUG: true
    APP_URL: http://127.0.0.1:8000

dependencies:
  cache_directories:
    - ../mongodb-linux-x86_64-ubuntu1204-3.2.7
  pre:
    - sudo service mongod stop 
    - if [[ ! -d mongodb-linux-x86_64-ubuntu1204-3.2.7 ]]; then curl -L -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu1204-3.2.7.tgz && tar xvzf mongodb-linux-x86_64-ubuntu1204-3.2.7.tgz; fi 
    - sudo mv mongodb-linux-x86_64-ubuntu1204-3.2.7/bin/* /usr/bin/ 
    - sudo service mongod start
    - pecl install mongodb
    - echo "extension=mongodb.so" > /opt/circleci/php/7.0.4/etc/conf.d/mongodb.ini
    - printf "\n" | pecl install yaml-2.0.0
    - echo "extension=yaml.so" > /opt/circleci/php/7.0.4/etc/conf.d/yaml.ini
    - composer install --no-interaction
    - npm i --prefix vendor/acidjazz/larpug/node/
    - php ./artisan serve
